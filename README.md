# Logistic

Приложение предназначено для учета движения технических средств компании и заказчиков.

В приложении реализован учет приема оборудования от заказчика для проведения ремонтных
и регламентных работ, учет отправки принятого оборудования сторонним организациям для проведения ремонта, приема 
отремонтированного оборудования и выдачи его заказчику.

Помимо этого отдельным разделом реализован учет выдачи оборудования из состава ЗИП (запасные части и принадлежности) 
и его обратный прием.

### Приложение содержит из следующих модулей:

- Logistic Frontend - реализует взаимодействие пользователя с приложением;
- Logistic Backend - реализует функционал серверной части;
- База данных PostgreSQL;
- Облачное хранилище S3.

### Приложение структурно состоит из следующих компонентов:

- Справочники:

    - Типов оборудования;
    - Типов систем, к которым оборудование относится;
    - Объектов заказчиков, с которых поступает оборудование;
    - Ремонтных мастерских, где проводятся ремонтные работы;
    - Ответственных сотрудников, осуществляющих прием и выдачу оборудования.

- Основная таблица, содержащая сведения о движении оборудования;
- Таблица ЗИП, содержащая сведения о выдаче и приеме оборудования из состава ЗИП;
- Модуль формирования актов приема/отправки/выдачи оборудования;
- Модуль хранения сформированных актов и их сканов в хранилище S3 и информации о них в базе данных.

# Logistic Backend.

## Предназначение.

Данный модуль предназначен для реализации функционала серверной части приложения
Logistic.

Модуль написан на языке программирования Python 3.10 с использованием Django. Подробнее об используемых библиотеках
в файле [requirements.txt](requirements.txt).


Модуль реализует следующие задачи:

- Создание структуры базы данных ([models.py](logistics_backend/logistics/models.py));
- Работа с базой данной (чтение/запись/изменение/удаление данных);
- Обработка запросов пользователя через rest API и выдача необходимых данных;
- Работа с хранилищем S3 (загрузка в хранилище и получение из него сформированных актов и их сканов, 
загруженных пользователем);
- Авторизация пользователей в системе.

## База данных.

В приложении используется база данных PostgreSQL (БД), развернутая на отдельном сервере. 

Параметры доступа к БД должны быть введены в качестве переменных окружения (указаны в файле [.env](.env)).

Создание таблиц БД производится штатными средствами библиотеки Django до первого запуска приложения
путем выполнения в командной строке в директории проекта следующих команд:
- python manage.py makemigrations
- python manage.py migrate

## Работа с базой данных.

Работа с базой данной (чтение/запись/изменение/удаление данных) реализуется с применением Django ORM в соответствии 
с запросами, поступающими от пользователей через модуль Logistic Frontend.

## Обработка запросов пользователя.

Обработка запросов производится после их получение на один из адресов API.

Адреса API содержатся в файле [urls.py](logistics_backend/logistics/urls.py).

### Основные функции для обработки запросов пользователей:

- Работа с общей таблицей (/main) - предназначена для получения/внесения/изменения/удаления данных, 
содержащихся в общей таблице приложения и получения данных таблиц, которые с ней связаны.
В том числе имена файлов актов, относящихся к каждой записи.
- Работа с таблицей ЗИП (/spares) - предназначена для получения/внесения/изменения/удаления данных, 
содержащихся в таблице ЗИП и получения данных таблиц, которые с ней связаны.
В том числе имена файлов актов, относящихся к каждой записи.
- Работа со справочниками (/references) - предназначена для получения/внесения/изменения данных,
содержащихся в таблицах справочниках.
- Формирование и получение актов (get_act/) - предназначена для формирования акта из шаблона и данных записей таблицы 
(общей/ЗИП), которые были выбраны пользователем (метод POST), внесения данных о созданном акте в таблицы БД
и сохранения сформированного акта в хранилище S3. 
А также для получения файлов (метод GET) ранее сформированных актов из хранилища S3 по имени файла, 
получаемого из запроса пользователя и выдачи файла пользователю для загрузки.
- Загрузка сканов актов (upload_act/) - предназначена для загрузки сканов подписанных актов в формате .pdf и
внесения данных о созданном акте в таблицы БД. Файл передается с модуля Logistic Frontend в кодировке base64 
(вызвано необходимостью передачи файла в теле запроса в формате JSON). А также для сохранения полученного файла в
хранилище S3.

## Авторизация пользователей в системе.

Авторизация пользователей в системе реализована на стандарте JSON Web Token (JWT). 

Создание пользователей производится с использованием штатной панели администратора Django (/admin).

Получение токена производится путем передачи учетных данных на адрес token api (api/token/).

Обновление токена производится через запрос на адрес обновления (api/token/refresh/).
